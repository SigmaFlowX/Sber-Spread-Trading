# SBER/SBERP Spread Trading Strategy
This strategy can be used for any cointegrated assets, SBER and SBERP are just the most obvious ones on MOEX. 


A simple linear model is used:
Price(SBER) = a * Price(SBERP) + b + E, <br>
where E is stationary and mean revearting.

Then the Z-score is calculated for E = a * Price(SBER) - Price(SBERP) - b <br>

Entry conditions: <br>
If z > z_threshold: short a * SBER and long SBERP <br>
If z < -z_threshold: short SBERP and long a * SBERP

Exit conditions: <br>
z <= 0 <br>
z >= 0 <br>

Walk forward optimization is performed using optuna. <br>
Fees and included in the model, but not the slippage.

## Walk-Forward Optimization Results
10% of the balance is used for each trade, initial balance is 1 000 000.  <br>
Note that the sharpe ratio calculation is obviously not correct and yet to be reworked. 

Main limiting factors are fees and possible slippage (slippage was not modeled)
| train_start   | train_end   | test_start   | test_end   |   annualized_return_% |   sharpe |   profit_% |   absolute_profit |   total_trades |   win_ratio_% |   avg_holding_hours |   max_pnl |   min_pnl |   avg_pnl |   paid_fees |   z_threshold |   spread_window |   z_window |
|:--------------|:------------|:-------------|:-----------|----------------------:|---------:|-----------:|------------------:|---------------:|--------------:|--------------------:|----------:|----------:|----------:|------------:|--------------:|----------------:|-----------:|
| 2015-01-05    | 2015-07-05  | 2015-07-05   | 2015-10-05 |               6.23308 |  1.56806 |   1.50106  |          15010.6  |            389 |       66.3239 |             4.02442 |  14869.5  |  -5967.34 |   54.7455 |     6285.4  |      0.614405 |              22 |         32 |
| 2015-07-05    | 2016-01-05  | 2016-01-05   | 2016-04-05 |               3.21658 |  2.66689 |   0.783157 |           7831.57 |            191 |       63.8743 |             5.82897 |   2017    |  -2454.06 |   57.09   |     3072.62 |      1.78617  |              25 |         16 |
| 2016-01-05    | 2016-07-05  | 2016-07-05   | 2016-10-05 |               4.72425 |  4.56358 |   1.06725  |          10672.5  |            404 |       70.7921 |             4.25041 |   1030.06 |   -720.89 |   42.5113 |     6502.02 |      0.850752 |             281 |         10 |
| 2016-07-05    | 2017-01-05  | 2017-01-05   | 2017-04-05 |               5.38245 |  2.18067 |   1.21299  |          12129.9  |            112 |       66.9643 |            11.0759  |   9091.8  |   -793.6  |  124.352  |     1797.6  |      1.48711  |             130 |         41 |
| 2017-01-05    | 2017-07-05  | 2017-07-05   | 2017-10-05 |               3.69402 |  2.69783 |   0.897829 |           8978.29 |            264 |       68.5606 |             6.93497 |   1237.6  |  -1222.38 |   50.0767 |     4241.96 |      0.639896 |              38 |         47 |
| 2017-07-05    | 2018-01-05  | 2018-01-05   | 2018-04-05 |               8.94186 |  6.49737 |   2.01308  |          20130.8  |            345 |       69.2754 |             4.04976 |   2601.39 |  -1349.6  |   74.4514 |     5554.92 |      0.672794 |              18 |         46 |
| 2018-01-05    | 2018-07-05  | 2018-07-05   | 2018-10-05 |               6.33508 |  5.04004 |   1.52507  |          15250.7  |            393 |       68.4478 |             4.42239 |   1310.84 |   -815.18 |   54.8837 |     6318.63 |      0.919774 |              81 |         12 |
| 2018-07-05    | 2019-01-05  | 2019-01-05   | 2019-04-05 |               3.65957 |  7.00134 |   0.661484 |           6614.84 |            387 |       75.4522 |             3.14427 |    295.72 |   -361.58 |   33.1284 |     6205.87 |      0.665835 |             748 |         10 |
| 2019-01-05    | 2019-07-05  | 2019-07-05   | 2019-10-05 |               1.75725 |  2.48175 |   0.43495  |           4349.5  |            760 |       65.5263 |             2.03509 |    660.81 |   -473.34 |   21.732  |    12166.8  |      0.620839 |              13 |          6 |
| 2019-07-05    | 2020-01-05  | 2020-01-05   | 2020-04-05 |               6.8345  |  4.28268 |   1.60556  |          16055.6  |            308 |       65.2597 |             3.88853 |   2632.13 |   -953.95 |   68.1708 |     4940.98 |      1.09882  |              13 |         32 |
| 2020-01-05    | 2020-07-05  | 2020-07-05   | 2020-10-05 |               2.54244 |  2.7357  |   0.613644 |           6136.44 |            425 |       70.3529 |             3.79451 |    462.53 |   -956.97 |   30.4781 |     6816.75 |      0.707371 |              41 |         50 |
| 2020-07-05    | 2021-01-05  | 2021-01-05   | 2021-04-05 |               3.88143 |  6.28472 |   0.869089 |           8690.89 |            499 |       72.7455 |             2.45023 |    521.67 |   -632.46 |   33.4506 |     8000.97 |      0.833627 |             253 |         16 |
| 2021-01-05    | 2021-07-05  | 2021-07-05   | 2021-10-05 |               4.07631 |  9.57186 |   0.978313 |           9783.13 |            413 |       81.1138 |             4.05165 |    354.4  |   -332.61 |   39.7127 |     6618.23 |      1.0202   |             196 |         23 |
| 2021-07-05    | 2022-01-05  | 2022-01-05   | 2022-04-05 |              12.608   |  4.87234 |   2.93565  |          29356.5  |            221 |       71.4932 |             1.454   |   9069.55 |  -4601.53 |  148.924  |     3555.66 |      1.59875  |              15 |          5 |
| 2022-01-05    | 2022-07-05  | 2022-07-05   | 2022-10-05 |              13.0761  | 11.9959  |   3.10912  |          31091.2  |            623 |       78.8122 |             2.55377 |   1102.06 |   -800.15 |   66.1218 |    10102.7  |      0.871649 |              22 |         12 |
| 2022-07-05    | 2023-01-05  | 2023-01-05   | 2023-04-05 |               4.59922 |  8.36456 |   1.08926  |          10892.6  |           1131 |       78.0725 |             1.27203 |    393.03 |   -423.74 |   25.6798 |    18151.3  |      0.657629 |             107 |          5 |
| 2023-01-05    | 2023-07-05  | 2023-07-05   | 2023-10-05 |               5.27365 | 14.0811  |   1.11778  |          11177.8  |            532 |       93.609  |             2.52569 |    239.03 |   -182.32 |   37.0583 |     8537.21 |      0.846277 |             674 |         26 |
| 2023-07-05    | 2024-01-05  | 2024-01-05   | 2024-04-05 |               2.89319 | 13.2974  |   0.618793 |           6187.93 |            439 |       93.1663 |             3.53683 |    392.64 |    -92.42 |   30.102  |     7026.85 |      0.610938 |             575 |         42 |
| 2024-01-05    | 2024-07-05  | 2024-07-05   | 2024-10-05 |               4.11375 | 15.9914  |   0.864629 |           8646.29 |            258 |       94.9612 |             4.52132 |    308.1  |    -80.29 |   49.5319 |     4132.94 |      1.35891  |             741 |         46 |
| 2024-07-05    | 2025-01-05  | 2025-01-05   | 2025-04-05 |               5.25931 | 13.5358  |   1.19998  |          11999.8  |            496 |       88.5081 |             2.90457 |    282.98 |   -153.66 |   40.2293 |     7953.98 |      0.96274  |             134 |         36 |
| 2025-01-05    | 2025-07-05  | 2025-07-05   | 2025-10-05 |               3.8969  | 15.562   |   0.830281 |           8302.81 |            447 |       92.6174 |             3.18867 |    271.56 |   -111.4  |   34.5919 |     7159.78 |      0.939217 |            1012 |         45 |

## Data links

SBER<br>https://drive.google.com/file/d/1HjTwX0ZIwoqtYKKdl5y3fG3rUgcYqZiT/view?usp=sharing

SBERP<br>https://drive.google.com/file/d/1h9tjGM8Yg-Q_uYlmIJrtxOePQApaBU4L/view?usp=sharing



